<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 2 Selecting species of interest | Supplementary material for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot</title>
  <meta name="description" content="Section 2 Selecting species of interest | Supplementary material for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 2 Selecting species of interest | Supplementary material for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="pratikunterwegs/ebird-wghats-supplement" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 2 Selecting species of interest | Supplementary material for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot" />
  
  
  

<meta name="author" content="Vijay Ramesh" />
<meta name="author" content="Pratik R. Gupte" />
<meta name="author" content="Morgan W. Tingley" />
<meta name="author" content="VV Robin" />
<meta name="author" content="Ruth DeFries" />


<meta name="date" content="2020-12-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="landcover-classification.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#attribution"><i class="fa fa-check"></i><b>1.1</b> Attribution</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html"><i class="fa fa-check"></i><b>2</b> Selecting species of interest</a><ul>
<li class="chapter" data-level="2.1" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#prepare-libraries"><i class="fa fa-check"></i><b>2.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="2.2" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#read-species-of-interest"><i class="fa fa-check"></i><b>2.2</b> Read species of interest</a></li>
<li class="chapter" data-level="2.3" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#load-raw-data-for-locations"><i class="fa fa-check"></i><b>2.3</b> Load raw data for locations</a></li>
<li class="chapter" data-level="2.4" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#get-proportional-obs-counts-in-25km-cells"><i class="fa fa-check"></i><b>2.4</b> Get proportional obs counts in 25km cells</a></li>
<li class="chapter" data-level="2.5" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#which-species-are-reported-sufficiently-in-checklists"><i class="fa fa-check"></i><b>2.5</b> Which species are reported sufficiently in checklists?</a></li>
<li class="chapter" data-level="2.6" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#figure-checklist-distribution"><i class="fa fa-check"></i><b>2.6</b> Figure: Checklist distribution</a></li>
<li class="chapter" data-level="2.7" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#prepare-the-species-list"><i class="fa fa-check"></i><b>2.7</b> Prepare the species list</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="landcover-classification.html"><a href="landcover-classification.html"><i class="fa fa-check"></i><b>3</b> Landcover classification</a></li>
<li class="chapter" data-level="4" data-path="spatial-autocorrelation-of-climatic-predictors.html"><a href="spatial-autocorrelation-of-climatic-predictors.html"><i class="fa fa-check"></i><b>4</b> Spatial Autocorrelation of Climatic Predictors</a><ul>
<li class="chapter" data-level="4.1" data-path="spatial-autocorrelation-of-climatic-predictors.html"><a href="spatial-autocorrelation-of-climatic-predictors.html#load-libraries"><i class="fa fa-check"></i><b>4.1</b> Load libraries</a></li>
<li class="chapter" data-level="4.2" data-path="spatial-autocorrelation-of-climatic-predictors.html"><a href="spatial-autocorrelation-of-climatic-predictors.html#prepare-data"><i class="fa fa-check"></i><b>4.2</b> Prepare data</a></li>
<li class="chapter" data-level="4.3" data-path="spatial-autocorrelation-of-climatic-predictors.html"><a href="spatial-autocorrelation-of-climatic-predictors.html#calculate-variograms-of-environmental-layers"><i class="fa fa-check"></i><b>4.3</b> Calculate variograms of environmental layers</a></li>
<li class="chapter" data-level="4.4" data-path="spatial-autocorrelation-of-climatic-predictors.html"><a href="spatial-autocorrelation-of-climatic-predictors.html#visualise-variograms-of-environmental-data"><i class="fa fa-check"></i><b>4.4</b> Visualise variograms of environmental data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="climatic-raster-resampling.html"><a href="climatic-raster-resampling.html"><i class="fa fa-check"></i><b>5</b> Climatic raster resampling</a><ul>
<li class="chapter" data-level="5.1" data-path="climatic-raster-resampling.html"><a href="climatic-raster-resampling.html#prepare-landcover"><i class="fa fa-check"></i><b>5.1</b> Prepare landcover</a></li>
<li class="chapter" data-level="5.2" data-path="climatic-raster-resampling.html"><a href="climatic-raster-resampling.html#prepare-spatial-extent"><i class="fa fa-check"></i><b>5.2</b> Prepare spatial extent</a></li>
<li class="chapter" data-level="5.3" data-path="climatic-raster-resampling.html"><a href="climatic-raster-resampling.html#prepare-chelsa-rasters"><i class="fa fa-check"></i><b>5.3</b> Prepare CHELSA rasters</a></li>
<li class="chapter" data-level="5.4" data-path="climatic-raster-resampling.html"><a href="climatic-raster-resampling.html#resample-prepared-rasters"><i class="fa fa-check"></i><b>5.4</b> Resample prepared rasters</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="climate-in-relation-to-landcover.html"><a href="climate-in-relation-to-landcover.html"><i class="fa fa-check"></i><b>6</b> Climate in Relation to Landcover</a><ul>
<li class="chapter" data-level="6.1" data-path="climate-in-relation-to-landcover.html"><a href="climate-in-relation-to-landcover.html#prepare-libraries-1"><i class="fa fa-check"></i><b>6.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="6.2" data-path="climate-in-relation-to-landcover.html"><a href="climate-in-relation-to-landcover.html#prepare-environmental-data"><i class="fa fa-check"></i><b>6.2</b> Prepare environmental data</a></li>
<li class="chapter" data-level="6.3" data-path="climate-in-relation-to-landcover.html"><a href="climate-in-relation-to-landcover.html#climatic-variables-over-landcover"><i class="fa fa-check"></i><b>6.3</b> Climatic variables over landcover</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="distribution-of-observer-expertise.html"><a href="distribution-of-observer-expertise.html"><i class="fa fa-check"></i><b>7</b> Distribution of Observer Expertise</a><ul>
<li class="chapter" data-level="7.1" data-path="distribution-of-observer-expertise.html"><a href="distribution-of-observer-expertise.html#prepare-libraries-2"><i class="fa fa-check"></i><b>7.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="7.2" data-path="distribution-of-observer-expertise.html"><a href="distribution-of-observer-expertise.html#load-observer-expertise-scores-and-checklist-covariates"><i class="fa fa-check"></i><b>7.2</b> Load observer expertise scores and checklist covariates</a></li>
<li class="chapter" data-level="7.3" data-path="distribution-of-observer-expertise.html"><a href="distribution-of-observer-expertise.html#species-observed-in-relation-to-observer-expertise"><i class="fa fa-check"></i><b>7.3</b> Species observed in relation to observer expertise</a></li>
<li class="chapter" data-level="7.4" data-path="distribution-of-observer-expertise.html"><a href="distribution-of-observer-expertise.html#observer-expertise-in-relation-to-landcover"><i class="fa fa-check"></i><b>7.4</b> Observer expertise in relation to landcover</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="matching-effort-cutoffs-with-spatial-independence-criteria.html"><a href="matching-effort-cutoffs-with-spatial-independence-criteria.html"><i class="fa fa-check"></i><b>8</b> Matching Effort Cutoffs with Spatial Independence Criteria</a><ul>
<li class="chapter" data-level="8.1" data-path="matching-effort-cutoffs-with-spatial-independence-criteria.html"><a href="matching-effort-cutoffs-with-spatial-independence-criteria.html#load-librarires"><i class="fa fa-check"></i><b>8.1</b> Load librarires</a></li>
<li class="chapter" data-level="8.2" data-path="matching-effort-cutoffs-with-spatial-independence-criteria.html"><a href="matching-effort-cutoffs-with-spatial-independence-criteria.html#load-data"><i class="fa fa-check"></i><b>8.2</b> Load data</a></li>
<li class="chapter" data-level="8.3" data-path="matching-effort-cutoffs-with-spatial-independence-criteria.html"><a href="matching-effort-cutoffs-with-spatial-independence-criteria.html#visualise-limiting-effort-by-spatial-independence-limits"><i class="fa fa-check"></i><b>8.3</b> Visualise limiting effort by spatial independence limits</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="spatial-thinning-a-brief-comparison-of-approaches.html"><a href="spatial-thinning-a-brief-comparison-of-approaches.html"><i class="fa fa-check"></i><b>9</b> Spatial Thinning: A Brief Comparison of Approaches</a><ul>
<li class="chapter" data-level="9.1" data-path="spatial-thinning-a-brief-comparison-of-approaches.html"><a href="spatial-thinning-a-brief-comparison-of-approaches.html#prepare-libraries-3"><i class="fa fa-check"></i><b>9.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="9.2" data-path="spatial-thinning-a-brief-comparison-of-approaches.html"><a href="spatial-thinning-a-brief-comparison-of-approaches.html#traditional-grid-based-thinning"><i class="fa fa-check"></i><b>9.2</b> Traditional grid-based thinning</a></li>
<li class="chapter" data-level="9.3" data-path="spatial-thinning-a-brief-comparison-of-approaches.html"><a href="spatial-thinning-a-brief-comparison-of-approaches.html#network-based-thinning"><i class="fa fa-check"></i><b>9.3</b> Network-based thinning</a></li>
<li class="chapter" data-level="9.4" data-path="spatial-thinning-a-brief-comparison-of-approaches.html"><a href="spatial-thinning-a-brief-comparison-of-approaches.html#finding-modularity-in-proximity-networks"><i class="fa fa-check"></i><b>9.4</b> Finding modularity in proximity networks</a></li>
<li class="chapter" data-level="9.5" data-path="spatial-thinning-a-brief-comparison-of-approaches.html"><a href="spatial-thinning-a-brief-comparison-of-approaches.html#process-proximity-networks-in-r"><i class="fa fa-check"></i><b>9.5</b> Process proximity networks in R</a></li>
<li class="chapter" data-level="9.6" data-path="spatial-thinning-a-brief-comparison-of-approaches.html"><a href="spatial-thinning-a-brief-comparison-of-approaches.html#a-function-that-removes-sites"><i class="fa fa-check"></i><b>9.6</b> A function that removes sites</a></li>
<li class="chapter" data-level="9.7" data-path="spatial-thinning-a-brief-comparison-of-approaches.html"><a href="spatial-thinning-a-brief-comparison-of-approaches.html#removing-non-independent-sites"><i class="fa fa-check"></i><b>9.7</b> Removing non-independent sites</a></li>
<li class="chapter" data-level="9.8" data-path="spatial-thinning-a-brief-comparison-of-approaches.html"><a href="spatial-thinning-a-brief-comparison-of-approaches.html#measuring-method-fallibility"><i class="fa fa-check"></i><b>9.8</b> Measuring method fallibility</a></li>
<li class="chapter" data-level="9.9" data-path="spatial-thinning-a-brief-comparison-of-approaches.html"><a href="spatial-thinning-a-brief-comparison-of-approaches.html#prepare-data-for-python"><i class="fa fa-check"></i><b>9.9</b> Prepare data for Python</a></li>
<li class="chapter" data-level="9.10" data-path="spatial-thinning-a-brief-comparison-of-approaches.html"><a href="spatial-thinning-a-brief-comparison-of-approaches.html#count-props-under-threshold-in-python"><i class="fa fa-check"></i><b>9.10</b> Count props under threshold in Python</a></li>
<li class="chapter" data-level="9.11" data-path="spatial-thinning-a-brief-comparison-of-approaches.html"><a href="spatial-thinning-a-brief-comparison-of-approaches.html#plot-metrics-for-different-methods"><i class="fa fa-check"></i><b>9.11</b> Plot metrics for different methods</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="predicting-species-specific-occupancy.html"><a href="predicting-species-specific-occupancy.html"><i class="fa fa-check"></i><b>10</b> Predicting Species-specific Occupancy</a><ul>
<li class="chapter" data-level="10.1" data-path="predicting-species-specific-occupancy.html"><a href="predicting-species-specific-occupancy.html#prepare-libraries-4"><i class="fa fa-check"></i><b>10.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="10.2" data-path="predicting-species-specific-occupancy.html"><a href="predicting-species-specific-occupancy.html#read-data"><i class="fa fa-check"></i><b>10.2</b> Read data</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Supplementary material for <em>Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot</em></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="selecting-species-of-interest" class="section level1">
<h1><span class="header-section-number">Section 2</span> Selecting species of interest</h1>
<p>This script shows the proportion of checklists that report a particular species across every 25km by 25km grid across the Nilgiris and the Anamalais. Using this analysis, we arrived at a final list of species for occupancy modeling.</p>
<p>We derived this list from inclusion criteria adapted from the State of India’s Birds 2020 (Viswanathan et al., 2020). Initially, we considered all 561 species in eBird that occurred within the outlines of our study area. We then considered only those species that had a minimum of 1000 detections each between 2013 and 2019 (reducing to 303 species). Next, the study area was divided into 25 x 25 km cells following (Viswanathan et al., 2020). We then kept only those species that occurred in at least 5% of all checklists across 50% of the 25 x 25 km cells from where they have been reported (reducing to 93 species). We used the above criteria to ensure as much uniform sampling of a species as possible across our study area and to reduce any erroneous associations between environmental drivers and species occupancy. Across our final list of 93 species, we analyzed a total of ~3.2 million detections (presences) between 2013 and 2019.</p>
<div id="prepare-libraries" class="section level2">
<h2><span class="header-section-number">2.1</span> Prepare libraries</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># load libraries</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(data.table)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">library</span>(readxl)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">library</span>(magrittr)</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb1-7" title="7"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb1-8" title="8"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb1-9" title="9"></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb1-11" title="11"><span class="kw">library</span>(ggthemes)</a>
<a class="sourceLine" id="cb1-12" title="12"><span class="kw">library</span>(scico)</a>
<a class="sourceLine" id="cb1-13" title="13"></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="co"># round any function</span></a>
<a class="sourceLine" id="cb1-15" title="15">round_any &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">accuracy =</span> <span class="dv">25000</span>) {</a>
<a class="sourceLine" id="cb1-16" title="16">  <span class="kw">round</span>(x <span class="op">/</span><span class="st"> </span>accuracy) <span class="op">*</span><span class="st"> </span>accuracy</a>
<a class="sourceLine" id="cb1-17" title="17">}</a></code></pre></div>
</div>
<div id="read-species-of-interest" class="section level2">
<h2><span class="header-section-number">2.2</span> Read species of interest</h2>
<p>We initally considered all species that</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># add species of interest</span></a>
<a class="sourceLine" id="cb2-2" title="2">specieslist &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/01_list-all-spp-byCount.csv&quot;</span>)</a>
<a class="sourceLine" id="cb2-3" title="3">speciesOfInterest &lt;-<span class="st"> </span>specieslist<span class="op">$</span>scientific_name</a></code></pre></div>
</div>
<div id="load-raw-data-for-locations" class="section level2">
<h2><span class="header-section-number">2.3</span> Load raw data for locations</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># read in shapefile of the study area to subset by bounding box</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">library</span>(sf)</a>
<a class="sourceLine" id="cb3-3" title="3">wg &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;data/spatial/hillsShapefile/Nil_Ana_Pal.shp&quot;</span>)</a>
<a class="sourceLine" id="cb3-4" title="4">box &lt;-<span class="st"> </span><span class="kw">st_bbox</span>(wg)</a>
<a class="sourceLine" id="cb3-5" title="5"></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="co"># read in data and subset</span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="co"># To access the latest dataset, please visit: https://ebird.org/data/download and set the file path accordingly.</span></a>
<a class="sourceLine" id="cb3-8" title="8">ebd &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data/ebd_IN_relApr-2020.txt&quot;</span>)</a>
<a class="sourceLine" id="cb3-9" title="9">ebd &lt;-<span class="st"> </span>ebd[<span class="kw">between</span>(LONGITUDE, box[<span class="st">&quot;xmin&quot;</span>], box[<span class="st">&quot;xmax&quot;</span>]) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="st">  </span><span class="kw">between</span>(LATITUDE, box[<span class="st">&quot;ymin&quot;</span>], box[<span class="st">&quot;ymax&quot;</span>]), ]</a>
<a class="sourceLine" id="cb3-11" title="11">ebd &lt;-<span class="st"> </span>ebd[<span class="kw">year</span>(<span class="st">`</span><span class="dt">OBSERVATION DATE</span><span class="st">`</span>) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2013</span>, ]</a>
<a class="sourceLine" id="cb3-12" title="12"></a>
<a class="sourceLine" id="cb3-13" title="13"><span class="co"># make new column names</span></a>
<a class="sourceLine" id="cb3-14" title="14">newNames &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(<span class="kw">colnames</span>(ebd), <span class="st">&quot; &quot;</span>, <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-15" title="15"><span class="st">  </span><span class="kw">str_to_lower</span>()</a>
<a class="sourceLine" id="cb3-16" title="16"><span class="kw">setnames</span>(ebd, newNames)</a>
<a class="sourceLine" id="cb3-17" title="17"></a>
<a class="sourceLine" id="cb3-18" title="18"><span class="co"># keep useful columns</span></a>
<a class="sourceLine" id="cb3-19" title="19">columnsOfInterest &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb3-20" title="20">  <span class="st">&quot;scientific_name&quot;</span>, <span class="st">&quot;observation_count&quot;</span>, <span class="st">&quot;locality&quot;</span>,</a>
<a class="sourceLine" id="cb3-21" title="21">  <span class="st">&quot;locality_id&quot;</span>, <span class="st">&quot;locality_type&quot;</span>, <span class="st">&quot;latitude&quot;</span>,</a>
<a class="sourceLine" id="cb3-22" title="22">  <span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;observation_date&quot;</span>, <span class="st">&quot;sampling_event_identifier&quot;</span></a>
<a class="sourceLine" id="cb3-23" title="23">)</a>
<a class="sourceLine" id="cb3-24" title="24"></a>
<a class="sourceLine" id="cb3-25" title="25">ebd &lt;-<span class="st"> </span>ebd[, ..columnsOfInterest]</a></code></pre></div>
<p>Add a spatial filter and assign grids of 25km x 25km.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># strict spatial filter and assign grid</span></a>
<a class="sourceLine" id="cb4-2" title="2">locs &lt;-<span class="st"> </span>ebd[, .(longitude, latitude)]</a>
<a class="sourceLine" id="cb4-3" title="3"></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co"># transform to UTM and get 20km boxes</span></a>
<a class="sourceLine" id="cb4-5" title="5">coords &lt;-<span class="st"> </span><span class="kw">setDF</span>(locs) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="st">  </span><span class="kw">st_as_sf</span>(<span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="st">  `</span><span class="dt">st_crs&lt;-</span><span class="st">`</span>(<span class="dv">4326</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">as.data.table</span>(<span class="kw">st_coordinates</span>(.))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="st">  </span><span class="kw">st_transform</span>(<span class="dv">32643</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(.))</a>
<a class="sourceLine" id="cb4-11" title="11"></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co"># convert wg to UTM for filter</span></a>
<a class="sourceLine" id="cb4-13" title="13">wg &lt;-<span class="st"> </span><span class="kw">st_transform</span>(wg, <span class="dv">32643</span>)</a>
<a class="sourceLine" id="cb4-14" title="14">coords &lt;-<span class="st"> </span>coords <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-15" title="15"><span class="st">  </span><span class="kw">filter</span>(id <span class="op">%in%</span><span class="st"> </span><span class="kw">unlist</span>(<span class="kw">st_contains</span>(wg, coords))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-16" title="16"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">longitude =</span> X, <span class="dt">latitude =</span> Y) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">as.data.table</span>(<span class="kw">st_coordinates</span>(.))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-18" title="18"><span class="st">  </span><span class="kw">st_drop_geometry</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-19" title="19"><span class="st">  </span><span class="kw">as.data.table</span>()</a>
<a class="sourceLine" id="cb4-20" title="20"></a>
<a class="sourceLine" id="cb4-21" title="21"><span class="co"># remove unneeded objects</span></a>
<a class="sourceLine" id="cb4-22" title="22"><span class="kw">rm</span>(locs)</a>
<a class="sourceLine" id="cb4-23" title="23"><span class="kw">gc</span>()</a>
<a class="sourceLine" id="cb4-24" title="24"></a>
<a class="sourceLine" id="cb4-25" title="25">coords &lt;-<span class="st"> </span>coords[, .N, by =<span class="st"> </span>.(longitude, latitude, X, Y)]</a>
<a class="sourceLine" id="cb4-26" title="26"></a>
<a class="sourceLine" id="cb4-27" title="27">ebd &lt;-<span class="st"> </span><span class="kw">merge</span>(ebd, coords, <span class="dt">all =</span> <span class="ot">FALSE</span>, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>))</a>
<a class="sourceLine" id="cb4-28" title="28"></a>
<a class="sourceLine" id="cb4-29" title="29">ebd &lt;-<span class="st"> </span>ebd[(longitude <span class="op">%in%</span><span class="st"> </span>coords<span class="op">$</span>longitude) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb4-30" title="30"><span class="st">  </span>(latitude <span class="op">%in%</span><span class="st"> </span>coords<span class="op">$</span>latitude), ]</a></code></pre></div>
</div>
<div id="get-proportional-obs-counts-in-25km-cells" class="section level2">
<h2><span class="header-section-number">2.4</span> Get proportional obs counts in 25km cells</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># round to 25km cell in UTM coords</span></a>
<a class="sourceLine" id="cb5-2" title="2">ebd[, <span class="st">`</span><span class="dt">:=</span><span class="st">`</span>(<span class="dt">X =</span> <span class="kw">round_any</span>(X), <span class="dt">Y =</span> <span class="kw">round_any</span>(Y))]</a>
<a class="sourceLine" id="cb5-3" title="3"></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co"># count checklists in cell</span></a>
<a class="sourceLine" id="cb5-5" title="5">ebd_summary &lt;-<span class="st"> </span>ebd[, nchk <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(sampling_event_identifier)),</a>
<a class="sourceLine" id="cb5-6" title="6">  by =<span class="st"> </span>.(X, Y)</a>
<a class="sourceLine" id="cb5-7" title="7">]</a>
<a class="sourceLine" id="cb5-8" title="8"></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="co"># count checklists reporting each species in cell and get proportion</span></a>
<a class="sourceLine" id="cb5-10" title="10">ebd_summary &lt;-<span class="st"> </span>ebd_summary[, .(<span class="dt">nrep =</span> <span class="kw">length</span>(<span class="kw">unique</span>(</a>
<a class="sourceLine" id="cb5-11" title="11">  sampling_event_identifier</a>
<a class="sourceLine" id="cb5-12" title="12">))),</a>
<a class="sourceLine" id="cb5-13" title="13">by =<span class="st"> </span>.(X, Y, nchk, scientific_name)</a>
<a class="sourceLine" id="cb5-14" title="14">]</a>
<a class="sourceLine" id="cb5-15" title="15"></a>
<a class="sourceLine" id="cb5-16" title="16">ebd_summary[, p_rep <span class="op">:</span><span class="er">=</span><span class="st"> </span>nrep <span class="op">/</span><span class="st"> </span>nchk]</a>
<a class="sourceLine" id="cb5-17" title="17"></a>
<a class="sourceLine" id="cb5-18" title="18"><span class="co"># filter for soi</span></a>
<a class="sourceLine" id="cb5-19" title="19">ebd_summary &lt;-<span class="st"> </span>ebd_summary[scientific_name <span class="op">%in%</span><span class="st"> </span>speciesOfInterest, ]</a>
<a class="sourceLine" id="cb5-20" title="20"></a>
<a class="sourceLine" id="cb5-21" title="21"><span class="co"># complete the dataframe for no reports</span></a>
<a class="sourceLine" id="cb5-22" title="22"><span class="co"># keep no reports as NA --- allows filtering based on proportion reporting</span></a>
<a class="sourceLine" id="cb5-23" title="23">ebd_summary &lt;-<span class="st"> </span><span class="kw">setDF</span>(ebd_summary) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-24" title="24"><span class="st">  </span><span class="kw">complete</span>(</a>
<a class="sourceLine" id="cb5-25" title="25">    <span class="kw">nesting</span>(X, Y), scientific_name <span class="co"># ,</span></a>
<a class="sourceLine" id="cb5-26" title="26">    <span class="co"># fill = list(p_rep = 0)</span></a>
<a class="sourceLine" id="cb5-27" title="27">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-28" title="28"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(p_rep))</a></code></pre></div>
</div>
<div id="which-species-are-reported-sufficiently-in-checklists" class="section level2">
<h2><span class="header-section-number">2.5</span> Which species are reported sufficiently in checklists?</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="co"># A total of 42 unique grids (of 25km by 25km) across the study area</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="co"># total number of checklists across unique grids</span></a>
<a class="sourceLine" id="cb6-3" title="3"></a>
<a class="sourceLine" id="cb6-4" title="4">tot_n_chklist &lt;-<span class="st"> </span>ebd_summary <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="st">  </span><span class="kw">distinct</span>(X, Y, nchk)</a>
<a class="sourceLine" id="cb6-6" title="6"></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co"># species-specific number of grids</span></a>
<a class="sourceLine" id="cb6-8" title="8">spp_grids &lt;-<span class="st"> </span>ebd_summary <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="st">  </span><span class="kw">group_by</span>(scientific_name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="st">  </span><span class="kw">distinct</span>(X, Y) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="st">  </span><span class="kw">count</span>(scientific_name,</a>
<a class="sourceLine" id="cb6-12" title="12">    <span class="dt">name =</span> <span class="st">&quot;n_grids&quot;</span></a>
<a class="sourceLine" id="cb6-13" title="13">  )</a>
<a class="sourceLine" id="cb6-14" title="14"></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="co"># Write the above two results</span></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="kw">write_csv</span>(tot_n_chklist, <span class="st">&quot;data/nchk_per_grid.csv&quot;</span>)</a>
<a class="sourceLine" id="cb6-17" title="17"><span class="kw">write_csv</span>(spp_grids, <span class="st">&quot;data/ngrids_per_spp.csv&quot;</span>)</a>
<a class="sourceLine" id="cb6-18" title="18"></a>
<a class="sourceLine" id="cb6-19" title="19"><span class="co"># left-join the datasets</span></a>
<a class="sourceLine" id="cb6-20" title="20">ebd_summary &lt;-<span class="st"> </span><span class="kw">left_join</span>(ebd_summary, spp_grids, <span class="dt">by =</span> <span class="st">&quot;scientific_name&quot;</span>)</a>
<a class="sourceLine" id="cb6-21" title="21"></a>
<a class="sourceLine" id="cb6-22" title="22"><span class="co"># check the proportion of grids across which this cut-off is met for each species</span></a>
<a class="sourceLine" id="cb6-23" title="23"><span class="co"># Is it &gt; 90% or 70%?</span></a>
<a class="sourceLine" id="cb6-24" title="24"><span class="co"># For example, with a 3% cut-off, ~100 species are occurring in &gt;50%</span></a>
<a class="sourceLine" id="cb6-25" title="25"><span class="co"># of the grids they have been reported in</span></a>
<a class="sourceLine" id="cb6-26" title="26"></a>
<a class="sourceLine" id="cb6-27" title="27">p_cutoff &lt;-<span class="st"> </span><span class="fl">0.05</span> <span class="co"># Proportion of checklists a species has been reported in</span></a>
<a class="sourceLine" id="cb6-28" title="28">grid_proportions &lt;-<span class="st"> </span>ebd_summary <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-29" title="29"><span class="st">  </span><span class="kw">group_by</span>(scientific_name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-30" title="30"><span class="st">  </span><span class="kw">tally</span>(p_rep <span class="op">&gt;=</span><span class="st"> </span>p_cutoff) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-31" title="31"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop_grids_cut =</span> n <span class="op">/</span><span class="st"> </span>(spp_grids<span class="op">$</span>n_grids)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-32" title="32"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(prop_grids_cut))</a>
<a class="sourceLine" id="cb6-33" title="33"></a>
<a class="sourceLine" id="cb6-34" title="34">grid_prop_cut &lt;-<span class="st"> </span><span class="kw">filter</span>(</a>
<a class="sourceLine" id="cb6-35" title="35">  grid_proportions,</a>
<a class="sourceLine" id="cb6-36" title="36">  prop_grids_cut <span class="op">&gt;</span><span class="st"> </span>p_cutoff</a>
<a class="sourceLine" id="cb6-37" title="37">)</a>
<a class="sourceLine" id="cb6-38" title="38"></a>
<a class="sourceLine" id="cb6-39" title="39"><span class="co"># Write the results</span></a>
<a class="sourceLine" id="cb6-40" title="40"><span class="kw">write_csv</span>(grid_prop_cut, <span class="st">&quot;data/chk_5_percent.csv&quot;</span>)</a>
<a class="sourceLine" id="cb6-41" title="41"></a>
<a class="sourceLine" id="cb6-42" title="42"><span class="co"># Identifying the number of species that occur in potentially &lt;5% of all lists</span></a>
<a class="sourceLine" id="cb6-43" title="43">total_number_lists &lt;-<span class="st"> </span><span class="kw">sum</span>(tot_n_chklist<span class="op">$</span>nchk)</a>
<a class="sourceLine" id="cb6-44" title="44"></a>
<a class="sourceLine" id="cb6-45" title="45">spp_sum_chk &lt;-<span class="st"> </span>ebd_summary <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-46" title="46"><span class="st">  </span><span class="kw">distinct</span>(X, Y, scientific_name, nrep) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-47" title="47"><span class="st">  </span><span class="kw">group_by</span>(scientific_name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-48" title="48"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sum_chk =</span> <span class="kw">sum</span>(nrep)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-49" title="49"><span class="st">  </span><span class="kw">distinct</span>(scientific_name, sum_chk)</a>
<a class="sourceLine" id="cb6-50" title="50"></a>
<a class="sourceLine" id="cb6-51" title="51"><span class="co"># Approximately 90 to 100 species occur in &gt;5% of all checklists</span></a>
<a class="sourceLine" id="cb6-52" title="52">prop_all_lists &lt;-<span class="st"> </span>spp_sum_chk <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-53" title="53"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop_lists =</span> sum_chk <span class="op">/</span><span class="st"> </span>total_number_lists) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-54" title="54"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(prop_lists))</a></code></pre></div>
</div>
<div id="figure-checklist-distribution" class="section level2">
<h2><span class="header-section-number">2.6</span> Figure: Checklist distribution</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># add land</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">library</span>(rnaturalearth)</a>
<a class="sourceLine" id="cb7-3" title="3">land &lt;-<span class="st"> </span><span class="kw">ne_countries</span>(</a>
<a class="sourceLine" id="cb7-4" title="4">  <span class="dt">scale =</span> <span class="dv">50</span>, <span class="dt">type =</span> <span class="st">&quot;countries&quot;</span>, <span class="dt">continent =</span> <span class="st">&quot;asia&quot;</span>,</a>
<a class="sourceLine" id="cb7-5" title="5">  <span class="dt">country =</span> <span class="st">&quot;india&quot;</span>,</a>
<a class="sourceLine" id="cb7-6" title="6">  <span class="dt">returnclass =</span> <span class="kw">c</span>(<span class="st">&quot;sf&quot;</span>)</a>
<a class="sourceLine" id="cb7-7" title="7">)</a>
<a class="sourceLine" id="cb7-8" title="8"></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="co"># crop land</span></a>
<a class="sourceLine" id="cb7-10" title="10">land &lt;-<span class="st"> </span><span class="kw">st_transform</span>(land, <span class="dv">32643</span>)</a></code></pre></div>
<div class="figure">
<img src="figs/fig_species_distributions.png" alt="Proportion of checklists reporting a species in each grid cell (25km side) between 2013 and 2019. Checklists were filtered to be within the boundaries of the Nilgiris and the Anamalai hills (black outline), but rounding to 25km cells may place cells outside the boundary. Deeper shades of red indicate a higher proportion of checklists reporting a species." />
<p class="caption">Proportion of checklists reporting a species in each grid cell (25km side) between 2013 and 2019. Checklists were filtered to be within the boundaries of the Nilgiris and the Anamalai hills (black outline), but rounding to 25km cells may place cells outside the boundary. Deeper shades of red indicate a higher proportion of checklists reporting a species.</p>
</div>
</div>
<div id="prepare-the-species-list" class="section level2">
<h2><span class="header-section-number">2.7</span> Prepare the species list</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="co"># write the new list of species that occur in at least 5% of checklists across a minimum of 50% of the grids they have been reported in</span></a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3">new_sp_list &lt;-<span class="st"> </span><span class="kw">semi_join</span>(specieslist, grid_prop_cut, <span class="dt">by =</span> <span class="st">&quot;scientific_name&quot;</span>)</a>
<a class="sourceLine" id="cb8-4" title="4"></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="kw">write_csv</span>(new_sp_list, <span class="st">&quot;data/03_list-of-species-cutoff.csv&quot;</span>)</a></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="landcover-classification.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ebird_occupancy_supplementary_material.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
